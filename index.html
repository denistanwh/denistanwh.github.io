<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
		<title>Multi-City Energy Analysis</title>
		<link rel="stylesheet" type"text/css" href="app.css">
		<script type = "text/javascript" src="js/d3.v3.js"></script>
		<script type = "text/javascript" src="topojson.v0.min.js"></script>
		</script>
		<script type="text/javascript" src="./tooltip.js"></script>
	
	</head>

	<body>

<div class="container-fluid main-container">


<div id="header">
<h1 class="title">Multi-City Energy Analysis</h1>
<h4 class="author"><em>Yiqian Jin, Denis Tan, Jing Ye</em></h4>
<h4 class="date"><em>4 May 2015</em></h4>
</div>

<div id="TOC">
<ul>
<li><a href="#motivation">Motivation</a></li>
<li><a href="#methodology">Methodology</a><ul>
<li><a href="#grouping-of-cities">Grouping of Cities</a></li>
<li><a href="#forecasting-energy-demand">Forecasting Energy Demand</a></li>
<li><a href="#visualiation">Visualiation</a></li>
</ul></li>
<li><a href="#results-discussion">Results &amp; Discussion</a><ul>
<li><a href="#grouping-of-cities-1">Grouping of Cities</a></li>
<li><a href="#forecasting-energy-demand-1">Forecasting Energy Demand</a></li>
</ul></li>
<li><a href="#visualization">Visualization</a><ul>
<li><a href="#cluster-1-city-eugene">Cluster 1 City: Eugene</a></li>
<li><a href="#cluster-2-city-dakar">Cluster 2 City: Dakar</a></li>
<li><a href="#cluster-3-city-louisville">Cluster 3 City: Louisville</a></li>
<li><a href="#cluster-4-city-sacramento">Cluster 4 City: Sacramento</a></li>
</ul></li>
<li><a href="#conclusion">Conclusion</a></li>
<li><a href="#references">References</a></li>
</ul>
</div>

<div id="motivation" class="section level2">
<h2>Motivation</h2>
<p>Global energy demand is expected to rise by 37% from 2014 to 2040 (IEA, 2014), with cities absorbing most of the predicted demand expansion (The New Climate Economy, 2014). Moreover, three quarters of the global energy supply in 2040 will still be fossil-based (IEA, 2014), exacerbating anthropogenic climate change. Cities can be leading advocates on reducing per capita energy use and mitigating climate change (c40, n.d.). To this end, there are numerous global and regional city-networks that brings together city policy makers to facilitate sharing of best practices.</p>
<p>However, cross-city collaboration on reducing enegy demand tends to be politically- and economically-driven rather than data-driven. For instance, Chinese cities, despite having vastly different climate, have been gleaning best practices from Singapore in the energy domain (WEF, 2012). Best practices gleaned from political and economic partners may be ineffective due to the intrinsic differences in factors driving energy demand in different cities. Thus, there is value in identifying clusters of cities with similar energy demand patterns to make the sharing of best practices more efficient.</p>
<p>Energy demand is a function of many variables, including demographics, climate, and development stage. Much work has been done on energy demand forecasting over time, resulting in more and more realistic but complex models. This paper presents a data-driven approach to identifying groups of cities with similar demand pattern to optimize collaboration as well as forecasts and visualizes the short-term energy demand for one city from each of the groups. Our approach is agnostic to the underlying factors driving demand and deals only with the empirical demand pattern, using a simple but relatively underused clustering method for grouping and time-series method for forecasting.</p>
</div>
<div id="methodology" class="section level2">
<h2>Methodology</h2>
<div id="grouping-of-cities" class="section level3">
<h3>Grouping of Cities</h3>
<div id="cluster-analysis-k-means-algorithm" class="section level4">
<h4>Cluster Analysis &amp; K-means Algorithm</h4>
<p>To group cities, we apple cluster analysis. Cluster analysis, or clustering involves grouping objects in such a way that objects in the same group are more similar, by some pre-determined measure, to each other than to those in other groups. It is a main task of exploratory data mining, and a frequently used method for statistical data analysis, used in many fields, including machine learning and pattern recognition (Kaufman &amp; Rousseeuw, 2009).</p>
<p>One particular method of implementing cluster analysis is K-means clustering (Witten &amp; Hastie, 2014). It is a simple approach to group data into K distinct, non-overlapping clusters. We used the following algorithm for clustering:</p>
<p>To implement cluster analysis, we implemented three steps: pre-processing, grouping, and analysis.</p>
<p>First, we trimmed the raw dataset from an unbalanced panel of energy demand data of 43 cities to a dataset with just a single year of energy demand. We do this by dropping cities with less than a full calendar year of energy data, or has a visually obvious amount of zero-value data. The trimmed dataset has 29 cities remaining. The energy demand data, in MW, was also aggregated from the half-hourly level to the daily level to reduce the size of the dataset for quick computations. Data at the half-hourly level is unnecessarily granular for cluster analysis that spans a full calendar year. We then normalized energy demand data by subtracting the mean and using the standard deviation as a divisor. This normalization ensures that data from all cities are have zero for mean and one for standard deviation, making it possible for fair comparison. The trimmed dataset is depicted below in Figures 1.</p>
<p>Figure 1: Plot of 2013 Normalized Energy Demand Data from 29 Cities<br /><img src="paper/Fig1.png" alt="image" width="860"/></p>

<p>Figure 1 is visualized with the following code in R:</p>
<pre class="r"><code>ggplot(data=sub, aes(x=day, y=MW, color=city))+geom_line()+
  facet_wrap(~city, scales=&quot;free&quot;)
last_plot()+scale_x_datetime(labels = date_format(&quot;%b&quot;))</code></pre>
<p>Second, we group the data from 29 cities into four groups (clusters) using the K-means algorithm. The algorithm is summarized below:</p>
<ol style="list-style-type: decimal">
<li>Randomly assign a number, from 1 to K, to each of the observations. These serve as initial cluster assignments for the observations.</li>
<li>Iterate until the cluster assignment stops changing:
<ol style="list-style-type: decimal">
<li>For each of the K clusters, compute the cluster centroid. The Kth cluster centroid is the vector of the p feature means for the observations in the Kth cluster.</li>
<li>Assign each observation to the cluster whose centroid is closet (where closest is defined using Euclidean distance).</li>
</ol></li>
</ol>
<p>We implemented all steps in the cluster analysis using the default kmeans() function in the {stat} package of the open-sourced statistical software, R (version 3.0.2).</p>
<p>We note various issues associated with the method we applied. First, we are aware that groups obtained using the k-means method represent the local optimum rather than the global optimum. To reduce the impact of this limitation, we chose to increase the number of iterations during computation computation to obtain stable clustering results. Specifically, we set the iteration count to be 20 and simulated 10 different starting points. And the reslut is convergent as expected. Secondly, in this approach, as in most clustering analyses, the number of clusters is pre-specified, so prior knowledge of the number of groups is required. Mathematically, there are multiple tests that could determine the optimal number of clusters, with different methods providing slightly different results.</p>
<p>In this paper, we use the R function <em>NbClust</em> from package <em>{NbClust}</em> to obtain the optimal number of clusters by computing the Hubert Statistic for the clusters as well as the second differences. The Hubert Statistic is a similarity function used to determine effectiveness of clustering (Zaki, 2012). The results of the NbClust analysis is provided in figure 2. From the test results, the Hubert Statistic performance is acceptable with three or more clusters. We visually inspect the data and settled on four clusters.</p>
<p>Figure 2: Results of NbClust Test<br /><img src="paper/NbClust.png" alt="image" /></p>
<p>Figure 2 is visualized with the following code in R:</p>
<pre class="r"><code>res&lt;-NbClust(data.6, diss=NULL, distance = &quot;euclidean&quot;, min.nc=2, max.nc=10, method = &quot;kmeans&quot;, index = &quot;hubert&quot;)</code></pre>
<p>Finally, we analysed the four groups (clusters). We did this by considering the geographic location and local weather patterns of the various cities. This will be discussed in the Result &amp; Discussion section.</p>
</div>
</div>
<div id="forecasting-energy-demand" class="section level3">
<h3>Forecasting Energy Demand</h3>
<div id="overview-of-energy-demand-data" class="section level4">
<h4>Overview of Energy Demand Data</h4>
<p>After clustering energy data into four groups, we turn to forecasting. For forecasting, we trim the original dataset to the 29 cities used in the clustering analysis. Hence, the dataset now has energy data for multiple years. We also aggregated the half-hourly data to the daily level to remove unnecessary granularity.</p>
<p>The energy demand data shows periodicity and can be said to have three components: trend, seasonal and random component. Seasonality is defined as the tendency of time-series data to exhibit behavior that repeats itself in regular intervals. If the seasonal component is present, it can be additive (where the size of the seasonal component is constant) or multiplicative (where the size of the seasonal component is proportionate to the level of the trend). The random component is the residual after trend and seasonality have been removed. Using R, we applied decompose() function to a sample city from each of the four clusters and plotted the outcome in Figure 3.</p>
<p>Figure 3: Decomposition of Daily Energy Demand of Eugenia, Dakar, Louisville, and Sacramento<br /><img src="paper/Fig3.svg" alt="image" /></p>
</div>
<div id="holt-winters-times-series-forecasting-algoritm" class="section level4">
<h4>Holt-Winters Times Series Forecasting Algoritm</h4>
<p>Holt-Winters is a forecasting method for dealing with time series data with both trend and seasonal components. It is an extension of the Single Exponential Smoothing method. The Holt-Winters method has two versions, additive and multiplicative, the use of which depends on the characteristics of the particular time series. For simplicity, we use the additive method. Holt-Winters predictions are obtained as a weighted average of past observed values where the weights decline exponentially so that the values of recent observations contribute to the forecast more than the values of earlier observations. The additive formula of this model is as follow:</p>

<p>$$
\begin{align}
&amp; s<em>{i}=\alpha(x</em>{i}-p<em>{i-k})+(1-\alpha)(s</em>{i-1}+t<em>{i-1}) \
&amp; t</em>{i}=\beta(s<em>{i}-s</em>{i-1})+(1-\beta)t<em>{i-1} \
&amp; p</em>{i}=\gamma(x<em>{i}-s</em>{i})+(1-\gamma)p_{i-k} \
\end{align}
$$</p>

<p>Here $$\alpha, \beta, \gamma $$ represent data smoothing factor, trend smoothing factor, seasonal change smoothing factor separately and their values are between 0 to 1; k is the time period. Initially, we set$$s<em>{0}=x</em>{0}$$,  $$t<em>{0}=x</em>{1}-x_{0}$$.The prediction formula follows:</p>

<p>$$
\begin{align}
x<em>{i+h}=s</em>{i}+ht<em>{i}+p</em>{i-k+(h\,mod\,k)}
\end{align}
$$</p>
</div>
</div>
<div id="visualiation" class="section level3">
<h3>Visualiation</h3>
<p>We visualized the data from the above cluster analysis and forecasting steps through a three step procedure using d3 (Bostock, 2013). First, we present a world map centered in the Pacific to depict the cities we considered for this project. Second, zoom in to the 4 groups of cities and present their average daily energy demand over a period of 365 days. Each group of cities are visualized in a chart. Third, we further zoom in to the city level and visualize the energy forecast for a typical city in each of the 4 groups.</p>
<p>This cascade of visualizations emphasizes the “drill-down” technique espoused by Schneiderman (1996) in his seminal paper on the visual information seeking mantra. This way, the first visualization provides an overarching overview before the second and third visualization take reader into greater and greater detail. At the same time, we have kept the visualizations minimalist to maximize data-ink and minimize chart-junk (Tufte, 1983).</p>
</div>
</div>
<div id="results-discussion" class="section level2">
<h2>Results &amp; Discussion</h2>
<div id="grouping-of-cities-1" class="section level3">
<h3>Grouping of Cities</h3>

<p>Table 1 and Figure 4 shows the result of clustering. The map shows the geographical location of these 29 cities.</p>

<p>Table 1: Results of K-means Clustering<br><img src="paper/Table1.png" alt="image" /></p>

<p>Figure 4: Visualization of the 4 Clusters of Cities<br /><img src="paper/Fig7.png" alt="image" /><br />Note: From the figure, it is clear that the cities have been appropriately clustered according to the shape of their daily energy demand over the period of a single calendar year. Cluster 1 cities appear to have energy demand peak in January and trough in August. Cluster 2 cities appear to have a relatively flat energy demand profile throughout the year. Cluster 3 cities appear to have 2 peaks in energy demand per year in both January and August. Finally, cluster 4 cities appear have the opposite trend from cluster 1 cities, peaking in August but troughing in January.</p>
<p>Figure 4 is visualized using the following code:</p>
<pre class="r"><code>ggplot(data=data.7, aes(x=day, y=MW, color=city))+geom_line()+
  facet_wrap(~cluster, scales=&quot;free&quot;)</code></pre>
<p>Figure 5: Geographic location of 29 cities<br />
<div id="Map"> 
	<script type = "text/javascript"src="map.js"></script>
</div>
<br />Note: Cluster1 cities are in green; Cluster 2 cities are in purple; Cluster 3 cities are in red; and Cluster 4 cities are yellow</p>

<div id="cluster-1" class="section level4">
<h4>Cluster 1</h4>
<p>Figure 6 depicts the energy demand profile for cluster 1 cities.</p>
<p>Figure 6: Cluster 1 Normalized Energy Demand Plot Over 1 Year<br />
<div id="ClusterViz1">
	<script type = "text/javascript"src="cluster1.js"></script>
</div>
</p>
<p>Cities in Cluster 1 are: Abidjan, Eugene, Tacoma, Queensland.</p>
<p>In this cluster, yearly energy pattern turns out to be “U” style, with the peak in January (boreal winter, austral summer) and the smoothly valley in August (boreal summer, austral winter). Intuitively, this pattern should correspond with cities of one of two specifications:</p>
<ol style="list-style-type: decimal">
<li>Cities in the northern hemisphere that have mild summers such that air-conditioning use is not significant and winters that require some form of heating.</li>
<li>Cities in the southern hemisphere that have mild winters such that heating is not significant and summers that require some form of air-conditioning use.</li>
</ol>
<p>Eugene and Tacoma are both located in northwestern USA. Their proximity to the Pacific Coast mean that they are affected by warm currents, causing their seasons to be marked by warm, dry summers and wet, cool-to-chilly winters. Over the course of a year, their temperature typically varies from 38°F to 76°F and is rarely below 31°F or above 85°F. Hence, Tacoma and Eugene fall into the first of the two aforementioned types of cities.</p>
<p>Queensland is located in Australia in the southern hemisphere. The strong summers and mild winter mean that it corresponds to the second type of cities.</p>
<p>Abidjan, however, seems to be an outlier. Abidjan is a tropical city which should not have a ‘U’ shaped energy demand profile. This could potentially have been caused by the similarity of ‘U’ shaped profiles and flat profiles, constituting a limitation to the k-means method of clustering cities.</p>
</div>

<div id="cluster-2" class="section level4">
<h4>Cluster 2</h4>
<p>Figure 7 depicts the energy demand profile for cluster 2 cities.</p>
<p>Figure 7: Cluster 2 Normalized Energy Demand Plot Over 1 Year<br />

<div id="ClusterViz2">
	<script type = "text/javascript"src="cluster2.js"></script>
</div>
</p>

<p>Cities in Cluster 2 are: Dakar, Honolulu, Manila, Mbabane, Nairobi, Singapore, Antigua.</p>
<p>In this cluster, the energy demand profile appears to be flat. In other words, the intra-year fluctuations in energy demand is much less pronounced. Intuitively, this patterns should correspond with cities with one of two specifications:</p>
<ol style="list-style-type: decimal">
<li>Tropical cities that have very minimal temperature fluctuations throughout the year and are consistently warm and in need of cooling.</li>
<li>Cities that have mild climates that are neither in need of cooling nor heating.</li>
</ol>
<p>Looking into the data, Singapore and Nairobi are near the equator and, thus, consistently in need of cooling year round with no need for heating. In addition, the other 5 cities all located between -30 degrees to 30 degrees latitude and have little need for heating or cooling. Hence, the relatively flat energy demand profile makes intuitive sense.</p>
</div>

<div id="cluster-3" class="section level4">
<h4>Cluster 3</h4>
<p>Figure 8 depicts the energy demand profile for cluster 3 cities.</p>
<p>Figure 8: Cluster 3 Normalized Energy Demand Plot Over 1 Year<br />

<div id="ClusterViz3">
	<script type = "text/javascript"src="cluster3.js"></script>
</div>
</p>
<p>Cities in Cluster 3 are: Amman, Chattanooga, Colorado Springs, Kansas City, Louisville, New York, Omaha, Springfield, Tokyo, Detroit, Indianapolis, Philadelphia.</p>
<p>In this cluster, the energy demand profile appears to have 2 peaks, one during summer and one during winter. Intuitively, this pattern should correspond with cities need heating during winter and cooling during summer.</p>
<p>All cities in this cluster are located between the 30 and 60 degrees latitude. This supports the hypothesis that both heating and cooling is needed at different times of the year.</p></div>

<div id="cluster-4" class="section level4">
<h4>Cluster 4</h4>
<p>Figure 9 depicts the energy demand profile for cluster 4 cities.</p>
<p>Figure 9: Cluster 4 Normalized Energy Demand Plot Over 1 Year<br />

<div id="ClusterViz4">
	<script type = "text/javascript"src="cluster4.js"></script>
</div>
</p>
<p>Cities in Cluter 4 are: City of North Little Rock, El Paso, Los Angeles, Memphis, Sacramento, Delhi - BRPL.</p>
<p>In this cluster, yearly energy pattern turns out to be “N” style, with the much less pronounced peak in January (boreal winter, austral summer) when compared with Cluster 3 and a peak in August (boreal summer, austral winter). Intuitively, this pattern should correspond with cities of one of two specifications:</p>
<ol style="list-style-type: decimal">
<li>Cities in the southern hemisphere that have milder summers than those in Cluster 3 such that air-conditioning use is not significant and winters that require some form of heating.</li>
<li>Cities in the northern hemisphere that have milder winters than those in Cluster 3 such that heating is not significant and summers that require some form of air-conditioning use.</li>
</ol>
<p>Geographically, North Little Rock, El Paso, Memphis, Sacramento and Los Angeles are all in the southern and western region of USA. These cities have less harsh winters than those of Cluster 3. Delhi, although located separated from other cities in this group, occupy a similar latitude, and hence, has a similar climate. These cities all correspond to the second specification above.</p>
</div>
</div>

<div id="forecasting-energy-demand-1" class="section level3">
<h3>Forecasting Energy Demand</h3>
<p>We picked Eugene, Dakar, Louisville, and Sacramento to represent Cluster 1, 2, 3, and 4 respectively. Through application of the Holt-Winters forecasting algorithm, we obtained a model for each of the four cities. We then analyzed the model fit using the Box-Ljung residual test. The results are summarized in Table 2.</p>
<p>Table 2: Summary of Box-Ljung test results<br />

<p><img src="paper/Table6.png" alt="image" /></p>

<p>We present the forecasting results of each of the four cities separately, below. The first cluster’s representative, Abidjan, has a relatively flat, non-cyclical energy demand profile throughout the year with a distinct upward trend (see Figure 15).</p>

<p>Figure 13: Holt-Winters forecast for Eugene (Cluster1)</p>

<p><img src="paper/Fig13.png" alt="image" /></p>

<p>Note: Left chart depicts comparison between model (red) and original data (black). Right chart depicts the 365-day forecast of daily energy demand of Abidjan. Original data spanned 4 calendar years from 2010 to end of 2013.</p>

				<div id="City1">
				<button onclick="runCOne()">
				        Visualize
				    </button>
					<script type = "text/javascript"src="city1.js"></script>
				</div>	
				<br>

<p>The second cluster’s representative, Dakar, has both a general upward trend and a seasonal (cyclical) pattern that reaches its highest point in the middle of the year before declining towards end of the year.</p>

<p>Figure 14: Holt-Winters forecast for Dakar (Cluster 2)</p>

<p><img src="paper/Fig14.png" alt="image" /></p>

<p>Note: Left chart depicts comparison between model (red) and original data (black). Right chart depicts the 365-day forecast of daily energy demand of Dakar. Original data spanned 4 calendar years from 2011 to end of 2014.</p>

				<div id="City2">
				<button onclick="runCTwo()">
				        Visualize
				    </button>
					<script type = "text/javascript"src="city2.js"></script>
				</div>
				<br>

<p>The third cluster’s representative, Springfield, has significant periodicity on a yearly basis (see Figure 17). As is the case for cities in Cluster 3, Springfield has two energy demand peaks, a more pronounced peak in the summer and a less pronounced peak in the winter.</p>

<p>Figure 15: Holt-Winters forecast for Louisville (Cluster 3)</p>

<p><img src="paper/Fig15.png" alt="image" /></p>

<p>Note: Left chart depicts comparison between model (red) and original data (black). Right chart depicts the 365 day forecast of daily energy demand of Springfield. Original data spanned 3 calendar years from 2011 to end of 2013.</p>

				<div id="City3">
				<button onclick="runCThree()">
				        Visualize
				    </button>
					<script type = "text/javascript"src="city3.js"></script>
				</div>	
				<br>

<p>The fourth cluster’s representative, Sacramento, shows a large peak at its summer. Sacramento’s energy demand profile shows a slight downward trend from 2007 to 2013 (see Figure 18).
Figure 16: Holt-Winters forecast for Sacramento (Cluster 4)</p>

<p><img src="paper/Fig16.png" alt="image" /></p>

<p>Note: Left chart depicts comparison between model (red) and original data (black). Right chart depicts the 365 day forecast of daily energy demand of Sacramento. Original data spanned 7 calendar years from 2006 to end of 2013.</p>

				<div id="City4">
				<button onclick="runCFour()">
				        Visualize
				    </button>
					<script type = "text/javascript"src="city4.js"></script>
				</div>	
				<br>

<p>We also verified that the forecast errors obtained by deducting the fitted data from the original data are normally distributed (see Figure 19).</p>

<p>Figure 17: Forecast errors</p>

<p><img src="paper/Fig17.png" alt="image" /></p>

<p>Note: Top left: forecast errors for Abidjan; top right: forecast errors for Dakar; bottom left: forecast errors for Springfield; bottom right: forecast errors for Sacramento</p>

<h2>Visualization</h2>

<p>As mentioned, we implemented the visualizations using the cascade, “drill-down” approach. A static image of the visualization is provided in Figure 20. The interactive visualizations are available at http://denistanwh.github.io.</p>

<p>Figure 18: Static screenshot of a single frame of the visualization</p>

<p><img src="paper/Fig18.png" alt="image" /></p>

<p>Note: Image zoomed in significantly to avoid truncation</p>

<h1>Conclusion</h1>

<p>Using energy demand data from 43 cities, we trimmed the data down to 30 cities and stratified them into 4 groups based on similarity in the shape of their energy demand curves. We then applied a Holt-Winters time-series algorithm to forecast the energy demand over a period of 365 days for each chosen city. Finally, we visualized the energy data and forecasts using a cascading “drill-down” approach. This approach allows us to first depict an overview of the data before zooming into the granular details, in line with Schneiderman’s visual information seeking mantra. We believe that this is an appropriate technique to present the energy information to an audience of disparate, middle-class energy consumption decision makers around the world. We hope that the access to this information will incrementally change the decentralized decisions made by all of these decision makers, arresting or slowing the projected explosion in global energy demand.</p>
		
	</body>
</html>